# ============================================================================
# æ–‡ä»¶: analysis/report.py
# ============================================================================
"""
æŠ¥å‘Šç”Ÿæˆå™¨ - å¯è§†åŒ–æŠ¥å‘Šè¾“å‡º
"""
import pandas as pd
from typing import Dict, Optional
from dataclasses import dataclass

from .performance import PerformanceMetrics, PerformanceAnalyzer


class ReportGenerator:
    """æŠ¥å‘Šç”Ÿæˆå™¨"""
    
    @staticmethod
    def print_backtest_summary(
        metrics: PerformanceMetrics,
        strategy_name: str = "Strategy"
    ) -> str:
        """æ‰“å°å›æµ‹æ‘˜è¦"""
        m = metrics
        report = f"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸ“Š å›æµ‹ç»©æ•ˆæŠ¥å‘Š                               â•‘
â•‘                    {strategy_name:<40}â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                  â•‘
â•‘  ğŸ“ˆ æ”¶ç›ŠæŒ‡æ ‡                                                     â•‘
â•‘  â”œâ”€ æ€»æ”¶ç›Šç‡:        {m.total_return:>10.2%}                           â•‘
â•‘  â”œâ”€ å¹´åŒ–æ”¶ç›Š:        {m.annual_return:>10.2%}                           â•‘
â•‘  â””â”€ æœ€å¤§å›æ’¤:        {m.max_drawdown:>10.2%}                           â•‘
â•‘                                                                  â•‘
â•‘  ğŸ“Š é£é™©æŒ‡æ ‡                                                     â•‘
â•‘  â”œâ”€ å¹´åŒ–æ³¢åŠ¨ç‡:      {m.volatility:>10.2%}                           â•‘
â•‘  â”œâ”€ å¤æ™®æ¯”ç‡:        {m.sharpe_ratio:>10.3f}                           â•‘
â•‘  â”œâ”€ ç´¢æè¯ºæ¯”ç‡:      {m.sortino_ratio:>10.3f}                           â•‘
â•‘  â””â”€ å¡ç›æ¯”ç‡:        {m.calmar_ratio:>10.3f}                           â•‘
â•‘                                                                  â•‘
â•‘  ğŸ¯ äº¤æ˜“ç»Ÿè®¡                                                     â•‘
â•‘  â”œâ”€ æ—¥èƒœç‡:          {m.win_rate:>10.2%}                           â•‘
â•‘  â”œâ”€ ç›ˆäºæ¯”:          {m.profit_loss_ratio:>10.3f}                           â•‘
â•‘  â”œâ”€ æœ€ä½³å•æ—¥:        {m.best_day:>10.2%}                           â•‘
â•‘  â””â”€ æœ€å·®å•æ—¥:        {m.worst_day:>10.2%}                           â•‘
â•‘                                                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""
        print(report)
        return report
    
    @staticmethod
    def print_comparison_table(comparison_df: pd.DataFrame) -> str:
        """æ‰“å°å¯¹æ¯”è¡¨"""
        report = "\n" + "=" * 80 + "\n"
        report += "ç­–ç•¥å¯¹æ¯”\n"
        report += "=" * 80 + "\n"
        report += comparison_df.to_string()
        report += "\n" + "=" * 80
        print(report)
        return report
    
    @staticmethod
    def print_golden_stocks(df: pd.DataFrame) -> str:
        """æ‰“å°é‡‘è‚¡è¡¨"""
        report = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        ğŸŒŸ ä»Šæ—¥é‡‘è‚¡æ¨è                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
"""
        report += df.to_string()
        report += """
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""
        print(report)
        return report