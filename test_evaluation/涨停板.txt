┌─────────────────────────────────────────────────────────────────────────────┐
│                        涨停板敢死队风险规避策略                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  一、买入时的涨停风险                                                       │
│  ══════════════════════════════════════════════════════════════════════    │
│                                                                             │
│  1. 封死涨停 (封单/流通盘 > 5%)                                            │
│     ┌─────────────────────────────────────────────────────────────────┐    │
│     │ 处理: 直接放弃，不追涨停                                        │    │
│     │ 原因: 大概率挂单排不上，次日大幅高开后可能冲高回落             │    │
│     │ 策略: 等待次日开盘回调时再考虑                                  │    │
│     └─────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  2. 开板涨停 (曾经开板 1-2 次)                                             │
│     ┌─────────────────────────────────────────────────────────────────┐    │
│     │ 处理: 可考虑参与，但仓位减半                                    │    │
│     │ 判断: 开板次数 ≤ 2 且 回封速度快 (1分钟内)                     │    │
│     │ 挂单: 涨停价 - 0.01 元                                          │    │
│     │ 风险: 成交概率约 50-60%                                         │    │
│     └─────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  3. 多次开板 (开板 ≥ 3 次)                                                 │
│     ┌─────────────────────────────────────────────────────────────────┐    │
│     │ 处理: 坚决放弃                                                  │    │
│     │ 原因: 封单不坚决，主力可能在出货                                │    │
│     │ 风险: 次日大概率低开                                            │    │
│     └─────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  二、卖出时的跌停风险                                                       │
│  ══════════════════════════════════════════════════════════════════════    │
│                                                                             │
│  1. 跌停封死                                                               │
│     ┌─────────────────────────────────────────────────────────────────┐    │
│     │ 处理: 挂跌停价排队                                              │    │
│     │ 估算: 排队位置 ≈ 封单量 × 50%                                   │    │
│     │ 成交概率: 通常只有 10-30% 能成交                                │    │
│     │ 备选: 考虑次日集合竞价挂单 (9:15-9:20 可撤单)                  │    │
│     └─────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  2. 跌停开板                                                               │
│     ┌─────────────────────────────────────────────────────────────────┐    │
│     │ 处理: 立即市价卖出！                                            │    │
│     │ 关键: 开板瞬间是最佳逃命窗口                                    │    │
│     │ 实现: 监控盘口，开板即挂市价单                                  │    │
│     │ 成交概率: 约 70-80%                                             │    │
│     └─────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  3. 连续跌停 (一字跌停)                                                    │
│     ┌─────────────────────────────────────────────────────────────────┐    │
│     │ 处理: 每日 9:15 集合竞价挂跌停价                                │    │
│     │ 技巧: 9:15 第一时间挂单，排在最前面                            │    │
│     │ 预期: 每天有小概率成交一部分                                    │    │
│     │ 心态: 认命，慢慢出                                              │    │
│     └─────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  三、系统层面的保护措施                                                     │
│  ══════════════════════════════════════════════════════════════════════    │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │ 1. 涨停敞口限制: 追涨停资金不超过总资金 10%                          │ │
│  │ 2. 单票涨停限制: 单只涨停股不超过 5%                                 │ │
│  │ 3. 默认不追: allow_limit_up_chase = False                            │ │
│  │ 4. 开板次数检查: 超过 2 次自动排除                                   │ │
│  │ 5. 封单强度检查: 封单/流通盘 < 3% 视为弱封                          │ │
│  │ 6. 跌停持仓预警: 持仓跌停时立即通知                                  │ │
│  │ 7. 预留逃命资金: 总仓位不超过 70%，保留 30% 应对极端行情            │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  四、代码实现关键点                                                         │
│  ══════════════════════════════════════════════════════════════════════    │
│                                                                             │
│  ```python                                                                  │
│  # 涨停检测                                                                 │
│  is_limit_up = close >= prev_close * 1.095                                 │
│  is_hard_sealed = limit_up_volume / float_shares > 0.05                    │
│                                                                             │
│  # 买入时                                                                   │
│  if is_limit_up and is_hard_sealed:                                        │
│      return REJECT("涨停封死")                                              │
│                                                                             │
│  # 卖出时                                                                   │
│  if is_limit_down:                                                         │
│      if is_opening:  # 开板                                                │
│          execute_market_sell()                                              │
│      else:  # 封死                                                          │
│          queue_at_limit_down_price()                                        │
│          estimate_fill_probability()                                        │
│  ```                                                                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘